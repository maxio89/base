<!DOCTYPE html>
<html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html"
                xmlns:rich="http://richfaces.org/rich" xmlns:f="http://java.sun.com/jsf/core" xmlns:s="http://jboss.org/seam/faces"
                xmlns:cu="http://java.sun.com/jsf/composite/components" template="/layout/template.xhtml">

    <f:metadata>
        <f:viewParam name="email" value="#{forgottenPasswordView.emailAddress}"/>
        <f:viewParam name="token" value="#{forgottenPasswordView.token}"/>
        <s:viewAction action="#{forgottenPasswordView.validate}" onPostback="#{false}"/>
    </f:metadata>

    <ui:define name="body">

        <!-- remind password form -->
        <rich:panel rendered="#{not identity.loggedIn}" styleClass="grid_8 prefix_8 suffix_8">
            <f:facet name="header">#{messages['view.forgottenPassword.newPasswordHeader']}</f:facet>
            <h:panelGroup rendered="#{forgottenPasswordView.tokenAndEmailProvided}">
                <h:form>
                    <rich:notifyMessages globalOnly="true"/>
                    <rich:notifyMessage for="pM"/>
                    <rich:graphValidator id="pM" value="#{forgottenPasswordView.passwordBean}"/>
                    <cu:edit label="#{messages['view.forgottenPassword.passwordOneLabel']}">
                        <h:inputSecret id="i" value="#{forgottenPasswordView.passwordBean.password}" required="true">
                            <rich:validator/>
                        </h:inputSecret>
                    </cu:edit>
                    <cu:edit label="#{messages['view.forgottenPassword.passwordTwoLabel']}">
                        <h:inputSecret id="i" value="#{forgottenPasswordView.passwordBean.passwordConfirmation}" required="true">
                            <rich:validator/>
                        </h:inputSecret>
                    </cu:edit>
                    <h:commandButton value="#{messages['view.forgottenPassword.changePasswordBtn']}" action="#{forgottenPasswordView.changePassword}"/>
                    <h:button value="#{messages['view.forgottenPassword.cancelBtn']}" outcome="cancelChange"/>
                </h:form>
            </h:panelGroup>
            <h:panelGroup rendered="#{not forgottenPasswordView.tokenAndEmailProvided}">
                #{messages['view.forgottenPassword.wrongResetLink']}
            </h:panelGroup>
        </rich:panel>

        <!-- if not logged in -->
        <h:panelGroup rendered="#{identity.loggedIn}">
            <h1>#{messages['view.forgottenPassword.mayNotBeLoggedIn']}</h1>
        </h:panelGroup>

    </ui:define>
</ui:composition>
</html>

